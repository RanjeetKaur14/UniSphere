<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Buzz - UniSphere</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #B19CD9;    /* Soft pastel blue */
            --secondary-color: #AA96DA;  /* Soft pastel purple */
            --accent-color: #C5FAD5;     /* Soft pastel mint */
            --light-color: #f8f9fa;
            --dark-color: #5D5D5D;       /* Soft dark gray */
            --success-color: #9BE3DE;    /* Soft pastel teal */
            --warning-color: #FFAAA7;    /* Soft pastel coral */
            --background-color: #E6E6FA; /* Soft off-white */
            --card-color: #FFFFFF;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--dark-color);
        }
        
        .navbar-brand {
            font-weight: 700;
            color: var(--secondary-color);
        }
        
        .nav-link {
            font-weight: 500;
            transition: color 0.3s;
            color: var(--dark-color);
        }
        
        .nav-link:hover {
            color: var(--secondary-color);
        }
        
        .pulse-card {
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.06);
            transition: transform 0.3s, box-shadow 0.3s;
            margin-bottom: 20px;
            border: none;
            background: white;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .pulse-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        
        .category-tag {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 8px;
            margin-bottom: 8px;
            color: white;
        }
        
        .doubts-tag {
            background-color: var(--primary-color);
        }
        
        .lostfound-tag {
            background-color: var(--success-color);
        }
        
        .urgent-tag {
            background-color: var(--warning-color);
        }
        
        .marketplace-tag {
            background-color: var(--secondary-color);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            border-radius: 12px;
            padding: 10px 24px;
            font-weight: 600;
            color: var(--dark-color);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background-color: #97C9D9;
            border-color: #97C9D9;
            transform: translateY(-2px);
        }
        
        .post-btn {
            background-color: var(--warning-color);
            border-color: var(--warning-color);
            border-radius: 12px;
            padding: 10px 24px;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }
        
        .post-btn:hover {
            background-color: #FF9C98;
            border-color: #FF9C98;
            transform: translateY(-2px);
        }
        
        .search-box {
            border-radius: 20px;
            padding: 10px 20px;
            border: 1px solid #E8E8E8;
            background: white;
        }
        
        .filter-btn {
            border-radius: 20px;
            padding: 8px 16px;
            font-weight: 500;
            border: 1px solid #E8E8E8;
            transition: all 0.3s ease;
        }
        
        .filter-btn:hover, .filter-btn.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: var(--dark-color);
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-color);
        }
        
        .action-btn {
            background: none;
            border: none;
            color: #8A8A8A;
            transition: all 0.3s ease;
            padding: 8px 12px;
            border-radius: 10px;
        }
        
        .action-btn:hover {
            color: var(--secondary-color);
            background-color: rgba(170, 150, 218, 0.1);
        }
        
        .action-btn.active {
            color: var(--secondary-color);
            background-color: rgba(170, 150, 218, 0.1);
        }
        
        .stats-number {
            font-weight: 700;
            font-size: 1.4rem;
            color: var(--secondary-color);
        }
        
        .stats-label {
            font-size: 0.85rem;
            color: #8A8A8A;
        }
        
        .feature-icon {
            font-size: 1.5rem;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }
        
        /* .hero-section {

            background: linear-gradient(135deg, #E6E6FA 0%, #B19CD9 50%, #E6E6FA 100%);
            box-shadow: 0 6px 20px rgba(177, 156, 217, 0.25);
            color: var(--dark-color);
            border-radius: 0 0 30px 30px;
            padding: 50px 0;
        } */
        .hero-section {
    background: linear-gradient(135deg, #E6E6FA 0%, #B19CD9 50%, #E6E6FA 100%);
    box-shadow: 
        0 15px 35px rgba(177, 156, 217, 0.4),
        0 5px 15px rgba(0, 0, 0, 0.3),
        inset 0 -2px 10px rgba(0, 0, 0, 0.2);
    color: var(--dark-color);
    border-radius: 0 0 30px 30px;
    padding: 50px 0;
    transform: perspective(1000px) rotateX(2deg);
    transform-origin: top;
    position: relative;
    z-index: 10;
}
        .section-title {
            position: relative;
            margin-bottom: 30px;
            font-weight: 700;
            color: var(--dark-color);
        }
        
        .section-title:after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 50px;
            height: 3px;
            background-color: var(--secondary-color);
        }
        
        .trending-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(45deg, var(--warning-color), #FF9C98);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 600;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .comment-section {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #F0F0F0;
        }
        
        .comment {
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 10px;
            border-left: 4px solid var(--primary-color);
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            border-radius: 12px;
        }
        
        .post-form {
            display: none;
        }
        
        .navbar {
            background: white;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
        }
        
        .badge {
            background-color: var(--accent-color);
            color: var(--dark-color);
        }
        
        /* footer {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: var(--dark-color);
            border-top: 1px solid rgba(0,0,0,0.05);
        } */
        footer {
    background: linear-gradient(135deg, #E6E6FA 0%, #B19CD9 50%, #E6E6FA 100%);
    box-shadow: 
        0 -5px 20px rgba(177, 156, 217, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
    color: var(--dark-color);
    border-top: 1px solid rgba(177, 156, 217, 0.2);
    transform: perspective(1000px) rotateX(-1deg);
    transform-origin: bottom;
    position: relative;
    z-index: 10;
}
        .btn-outline-primary {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-outline-primary:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
        
        .btn-outline-secondary {
            color: #8A8A8A;
            border-color: #E8E8E8;
        }
        
        .btn-outline-secondary:hover {
            background-color: #F0F0F0;
            border-color: #D0D0D0;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                UniSphere
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-home me-1"></i>Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#"><i class="fas fa-globe"></i> Campus Buzz</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-map-marker-alt me-1"></i>UniSphere Locator</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-shopping-cart me-1"></i>UniTrade</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fas fa-hdd me-1"></i>UniVault</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <div class="input-group search-box me-3">
                        <span class="input-group-text bg-transparent border-0">
                            <i class="fas fa-search text-muted"></i>
                        </span>
                        <input type="text" class="form-control border-0" placeholder="Search Campus Buzz..." id="searchInput">
                    </div>
                    <div class="dropdown">
                        <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle" id="userDropdown" data-bs-toggle="dropdown">
                            <img src="https://ui-avatars.com/api/?name=Student+User&background=A8D8EA&color=5D5D5D" alt="User" class="user-avatar me-2">
                            <span class="d-none d-md-inline">Student User</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Profile</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="display-5 fw-bold" style="color: #000000;">Campus Buzz</h1>
                    <p class="lead" style="color: #000000;">Your campus quick-help board for sharing doubts, lost & found items, and urgent needs.</p>
                    <div class="d-flex flex-wrap gap-2 mt-4">
                        <span class="badge bg-light text-dark fs-6 p-2">#Doubts</span>
                        <span class="badge bg-light text-dark fs-6 p-2">#Lost&Found</span>
                        <span class="badge bg-light text-dark fs-6 p-2">#UrgentHelp</span>
                        <span class="badge bg-light text-dark fs-6 p-2">#QuickQuestions</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container my-5">
        <div class="row">
            <!-- Left Sidebar - Filters and Stats -->
            <div class="col-lg-3 mb-4">
                <!-- Quick Actions -->
                <div class="pulse-card p-3 mb-4">
                    <h5 class="section-title">Quick Actions</h5>
                    <button class="btn post-btn w-100 mb-3 text-white" id="newPostBtn">
                        <i class="fas fa-plus-circle me-2"></i>New Post
                    </button>
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary filter-btn active" data-filter="all">All Posts</button>
                        <button class="btn btn-outline-primary filter-btn" data-filter="doubts">Doubts</button>
                        <button class="btn btn-outline-primary filter-btn" data-filter="lostfound">Lost & Found</button>
                        <button class="btn btn-outline-primary filter-btn" data-filter="urgent">Urgent Help</button>
                    </div>
                </div>
                
                <!-- Pulse Stats -->
                <div class="pulse-card p-3">
                    <h5 class="section-title">Pulse Stats</h5>
                    <div class="row text-center">
                        <div class="col-6 mb-3">
                            <div class="stats-number" id="postsToday">142</div>
                            <div class="stats-label">Posts Today</div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="stats-number" id="resolvedRate">87%</div>
                            <div class="stats-label">Resolved</div>
                        </div>
                        <div class="col-6">
                            <div class="stats-number" id="activeUsers">32</div>
                            <div class="stats-label">Active Now</div>
                        </div>
                        <div class="col-6">
                            <div class="stats-number" id="urgentPosts">14</div>
                            <div class="stats-label">Urgent</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Feed -->
            <div class="col-lg-6 mb-4">
                <!-- Create Post Card -->
                <div class="pulse-card p-3 mb-4 post-form" id="postForm">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">Create New Post</h5>
                        <button class="btn-close" id="closePostForm"></button>
                    </div>
                    <div class="d-flex align-items-center mb-3">
                        <img src="https://ui-avatars.com/api/?name=Student+User&background=A8D8EA&color=5D5D5D" alt="User" class="user-avatar me-3">
                        <input type="text" class="form-control" id="postTitle" placeholder="Post title...">
                    </div>
                    <div class="mb-3">
                        <textarea class="form-control" id="postContent" rows="3" placeholder="What's on your mind? Ask for help or share something..."></textarea>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <button class="btn btn-sm btn-outline-secondary me-2 post-category" data-category="doubts"><i class="fas fa-question-circle me-1"></i>Doubts</button>
                            <button class="btn btn-sm btn-outline-secondary me-2 post-category" data-category="lostfound"><i class="fas fa-search me-1"></i>Lost & Found</button>
                            <button class="btn btn-sm btn-outline-secondary post-category" data-category="urgent"><i class="fas fa-exclamation-triangle me-1"></i>Urgent</button>
                        </div>
                        <button class="btn btn-primary btn-sm" id="submitPost">Post</button>
                    </div>
                </div>
                
                <!-- Feed Filters -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">Recent Posts</h5>
                    <div class="d-flex">
                        <div class="dropdown me-2">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="fas fa-filter me-1"></i>Filter
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" data-sort="recent">Most Recent</a></li>
                                <li><a class="dropdown-item" href="#" data-sort="popular">Most Popular</a></li>
                                <li><a class="dropdown-item" href="#" data-sort="unresolved">Unresolved</a></li>
                            </ul>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="fas fa-sort me-1"></i>Sort
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" data-order="newest">Newest First</a></li>
                                <li><a class="dropdown-item" href="#" data-order="oldest">Oldest First</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Posts Container -->
                <div id="postsContainer">
                    <!-- Posts will be dynamically loaded here -->
                </div>
            </div>
            
            <!-- Right Sidebar - Features and Integration -->
            <div class="col-lg-3 mb-4">
                <!-- Key Features -->
                <div class="pulse-card p-3 mb-4">
                    <h5 class="section-title">Key Features</h5>
                    <div class="mb-3">
                        <div class="feature-icon">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <h6>Quick Doubts</h6>
                        <p class="small text-muted">Get instant help from peers and faculty on academic questions.</p>
                    </div>
                    <div class="mb-3">
                        <div class="feature-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h6>Lost & Found</h6>
                        <p class="small text-muted">Report lost items or help others find their belongings.</p>
                    </div>
                    <div class="mb-3">
                        <div class="feature-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h6>Urgent Help</h6>
                        <p class="small text-muted">Post urgent requests that need immediate attention.</p>
                    </div>
                    <div>
                        <div class="feature-icon">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <h6>Smart Integration</h6>
                        <p class="small text-muted">Seamlessly convert posts to Campus Cart listings.</p>
                    </div>
                </div>
                
                <!-- Integration with Unisphere -->
                <div class="pulse-card p-3">
                    <h5 class="section-title">UniSphere Integration</h5>
                    <div class="d-flex align-items-center mb-3">
                        <div class="bg-primary bg-opacity-10 p-2 rounded me-3">
                            <i class="fas fa-shopping-cart text-primary"></i>
                        </div>
                        <div>
                            <h6 class="mb-0">Campus Cart</h6>
                            <p class="small text-muted mb-0">Convert marketplace posts with one click</p>
                        </div>
                    </div>
                    <div class="d-flex align-items-center mb-3">
                        <div class="bg-success bg-opacity-10 p-2 rounded me-3">
                            <i class="fas fa-map-marker-alt text-success"></i>
                        </div>
                        <div>
                            <h6 class="mb-0">Campus Locator</h6>
                            <p class="small text-muted mb-0">Share locations for lost & found items</p>
                        </div>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="bg-warning bg-opacity-10 p-2 rounded me-3">
                            <i class="fas fa-hdd text-warning"></i>
                        </div>
                        <div>
                            <h6 class="mb-0">Private Drive</h6>
                            <p class="small text-muted mb-0">Save important posts to your drive</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5 style="color: #000000;">UniSphere</h5>
                    <p class="mb-0" style="color: #000000;">A unified college platform simplifying student life through connected modules.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0" style="color: #000000;">Built with   <i class="fas fa-heart text-danger"></i>       -  Ranjeet, Lavanya, Sriza, Akshat</p>
                    <p class="mb-0" style="color: #000000;">PulseFeed - Help Board for Campus Community</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- ADD THIS: Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script>
    // Firebase Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBaSOsbcryXaFB3kZgWQGUI3OEyDVQrvtc",
        authDomain: "pulsepointplus.firebaseapp.com",
        //databaseURL: "https://pulsepointplus-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "pulsepointplus",
        storageBucket: "pulsepointplus.firebasestorage.app",
        messagingSenderId: "1066631673823",
        appId: "1:1066631673823:web:b00f0388a9a48f6c2e366a",
        measurementId: "G-3LNPXKPS4B"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
</script>
    <!-- CamousBuzz JavaScript -->
    <script>
        // ALL YOUR EXISTING JAVASCRIPT CODE REMAINS EXACTLY THE SAME
        // Only the CSS colors have been changed to pastels
        
        // Sample data for posts
        const samplePosts = [
            {
                id: 1,
                user: "Rahul Sharma",
                avatar: "https://ui-avatars.com/api/?name=Rahul+Sharma&background=9BE3DE&color=5D5D5D",
                department: "Computer Science",
                time: "15 mins ago",
                title: "Need help with DBMS assignment - Query optimization",
                content: "I'm stuck with query optimization in my DBMS assignment. Can someone explain how to optimize nested queries with examples? The deadline is tomorrow!",
                category: "doubts",
                tags: ["doubts", "urgent"],
                likes: 12,
                comments: 7,
                saved: false,
                liked: false,
                trending: true,
                commentsList: [
                    { user: "Priya K.", text: "Check chapter 7 of the textbook, it has good examples!", time: "10 mins ago" },
                    { user: "Amit R.", text: "I can help you after 4 PM in the library", time: "5 mins ago" }
                ]
            },
            {
                id: 2,
                user: "Priya Patel",
                avatar: "https://ui-avatars.com/api/?name=Priya+Patel&background=FFAAA7&color=5D5D5D",
                department: "Electronics",
                time: "2 hours ago",
                title: "Lost my calculator in Lab 3B",
                content: "I think I left my Casio fx-991ES calculator in Lab 3B yesterday around 4 PM. It has a small sticker of Pikachu on the back. If anyone found it, please let me know!",
                category: "lostfound",
                tags: ["lostfound"],
                likes: 5,
                comments: 3,
                saved: false,
                liked: false,
                trending: false,
                commentsList: [
                    { user: "Rohan M.", text: "I saw one in the lost and found box near the admin office", time: "1 hour ago" }
                ]
            },
            {
                id: 3,
                user: "Amit Kumar",
                avatar: "https://ui-avatars.com/api/?name=Amit+Kumar&background=AA96DA&color=5D5D5D",
                department: "Mechanical",
                time: "5 hours ago",
                title: "Selling my barely used engineering drawing kit",
                content: "Selling my complete engineering drawing kit - used only twice. Includes compass, divider, scales, and protractor. Original price ₹850, selling for ₹400.",
                category: "marketplace",
                tags: ["marketplace"],
                likes: 8,
                comments: 4,
                saved: false,
                liked: false,
                trending: false,
                commentsList: [
                    { user: "Sneha P.", text: "Is it still available? Can I see it today?", time: "3 hours ago" }
                ]
            }
        ];

        // State management
        let posts = [...samplePosts];
        let currentFilter = 'all';
        let currentSort = 'recent';
        let currentOrder = 'newest';
        let selectedCategory = 'doubts';

        // DOM Elements
        const postsContainer = document.getElementById('postsContainer');
        const postForm = document.getElementById('postForm');
        const newPostBtn = document.getElementById('newPostBtn');
        const closePostForm = document.getElementById('closePostForm');
        const submitPost = document.getElementById('submitPost');
        const searchInput = document.getElementById('searchInput');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const postCategoryButtons = document.querySelectorAll('.post-category');
        const statsElements = {
            postsToday: document.getElementById('postsToday'),
            resolvedRate: document.getElementById('resolvedRate'),
            activeUsers: document.getElementById('activeUsers'),
            urgentPosts: document.getElementById('urgentPosts')
        };

        // Initialize the app
        // Initialize the app
document.addEventListener('DOMContentLoaded', function() {
    loadPostsFromFirebase(); // CHANGED: Load from Firebase
    setupEventListeners();
    updateStats();
});

        // Set up event listeners
        function setupEventListeners() {
            // New post button
            newPostBtn.addEventListener('click', togglePostForm);
            closePostForm.addEventListener('click', togglePostForm);
            
            // Submit post
            submitPost.addEventListener('click', createNewPost);
            
            // Filter buttons
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const filter = this.getAttribute('data-filter');
                    setActiveFilter(this, filter);
                });
            });
            
            // Post category buttons
            postCategoryButtons.forEach(button => {
                button.addEventListener('click', function() {
                    selectedCategory = this.getAttribute('data-category');
                    setActiveCategory(this);
                });
            });
            
            // Search functionality
            searchInput.addEventListener('input', debounce(handleSearch, 300));
            
            // Dropdown filters
            document.querySelectorAll('.dropdown-item[data-sort]').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    currentSort = this.getAttribute('data-sort');
                    renderPosts();
                });
            });
            
            document.querySelectorAll('.dropdown-item[data-order]').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    currentOrder = this.getAttribute('data-order');
                    renderPosts();
                });
            });
        }

        // Toggle post form visibility
        function togglePostForm() {
            postForm.style.display = postForm.style.display === 'none' || !postForm.style.display ? 'block' : 'none';
        }

        // Set active filter
        function setActiveFilter(button, filter) {
            filterButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            currentFilter = filter;
            renderPosts();
        }

        // Set active category for new post
        function setActiveCategory(button) {
            postCategoryButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
        }

        // Create new post
        // Create new post - SAVE TO FIREBASE
async function createNewPost() {
    const title = document.getElementById('postTitle').value.trim();
    const content = document.getElementById('postContent').value.trim();
    
    if (!title || !content) {
        showToast('Please fill in both title and content', 'warning');
        return;
    }
    
    try {
        const newPost = {
            user: "Student User",
            avatar: "https://ui-avatars.com/api/?name=Student+User&background=A8D8EA&color=5D5D5D",
            department: "Your Department",
            time: "Just now",
            title: title,
            content: content,
            category: selectedCategory,
            tags: [selectedCategory],
            likes: 0,
            comments: 0,
            saved: false,
            liked: false,
            trending: false,
            commentsList: [],
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        // Save to Firebase
        const docRef = await db.collection('campusBuzz_posts').add(newPost);
        newPost.id = docRef.id;
        
        posts.unshift(newPost);
        renderPosts();
        togglePostForm();
        
        // Clear form
        document.getElementById('postTitle').value = '';
        document.getElementById('postContent').value = '';
        
        showToast('Post published successfully!', 'success');
        updateStats();
    } catch (error) {
        console.error("Error creating post:", error);
        showToast('Error publishing post', 'error');
    }
}

        // Handle search with debouncing
        function handleSearch() {
            const searchTerm = searchInput.value.toLowerCase();
            if (searchTerm) {
                const filteredPosts = posts.filter(post => 
                    post.title.toLowerCase().includes(searchTerm) || 
                    post.content.toLowerCase().includes(searchTerm) ||
                    post.user.toLowerCase().includes(searchTerm)
                );
                renderPosts(filteredPosts);
            } else {
                renderPosts();
            }
        }

        // Debounce function for search
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Render posts to the DOM
        function renderPosts(postsToRender = posts) {
            // Apply filters
            let filteredPosts = postsToRender;
            if (currentFilter !== 'all') {
                filteredPosts = postsToRender.filter(post => post.category === currentFilter);
            }
            
            // Apply sorting
            filteredPosts = sortPosts(filteredPosts);
            
            // Generate HTML
            let postsHTML = '';
            
            if (filteredPosts.length === 0) {
                postsHTML = `
                    <div class="pulse-card p-5 text-center">
                        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                        <h5>No posts found</h5>
                        <p class="text-muted">Try adjusting your filters or search terms</p>
                    </div>
                `;
            } else {
                filteredPosts.forEach(post => {
                    const tagsHTML = post.tags.map(tag => 
                        `<span class="category-tag ${tag}-tag">#${tag.charAt(0).toUpperCase() + tag.slice(1)}</span>`
                    ).join('');
                    
                    const trendingBadge = post.trending ? '<div class="trending-badge">TRENDING</div>' : '';
                    
                    const commentsHTML = post.commentsList.map(comment => `
                        <div class="comment">
                            <div class="d-flex justify-content-between">
                                <strong>${comment.user}</strong>
                                <small class="text-muted">${comment.time}</small>
                            </div>
                            <p class="mb-0">${comment.text}</p>
                        </div>
                    `).join('');
                    
                    postsHTML += `
                        <div class="pulse-card p-4 position-relative" data-post-id="${post.id}">
                            ${trendingBadge}
                            <div class="d-flex align-items-center mb-3">
                                <img src="${post.avatar}" alt="User" class="user-avatar me-3">
                                <div>
                                    <h6 class="mb-0">${post.user}</h6>
                                    <small class="text-muted">${post.department} • ${post.time}</small>
                                </div>
                            </div>
                            <h5>${post.title}</h5>
                            <p class="mb-3">${post.content}</p>
                            <div class="mb-3">
                                ${tagsHTML}
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <button class="action-btn me-3 like-btn ${post.liked ? 'active' : ''}" data-post-id="${post.id}">
                                        <i class="${post.liked ? 'fas' : 'far'} fa-thumbs-up me-1"></i> <span class="like-count">${post.likes}</span>
                                    </button>
                                    <button class="action-btn me-3 comment-btn" data-post-id="${post.id}">
                                        <i class="far fa-comment me-1"></i> ${post.comments}
                                    </button>
                                    <button class="action-btn save-btn ${post.saved ? 'active' : ''}" data-post-id="${post.id}">
                                        <i class="${post.saved ? 'fas' : 'far'} fa-bookmark me-1"></i> Save
                                    </button>
                                </div>
                                ${post.category === 'marketplace' ? 
                                    '<button class="btn btn-sm btn-primary convert-to-cart" data-post-id="' + post.id + '">Post to Campus Cart</button>' : 
                                    '<button class="btn btn-sm btn-outline-primary share-location" data-post-id="' + post.id + '">Share Location</button>'
                                }
                            </div>
                            <div class="comment-section" id="comments-${post.id}">
                                <div class="mt-3">
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="Add a comment..." id="comment-input-${post.id}">
                                        <button class="btn btn-outline-primary add-comment" data-post-id="${post.id}">Post</button>
                                    </div>
                                </div>
                                <div class="mt-3" id="comment-list-${post.id}">
                                    ${commentsHTML}
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            postsContainer.innerHTML = postsHTML;
            
            // Add event listeners to dynamically created elements
            addPostEventListeners();
        }

        // Sort posts based on current criteria
        function sortPosts(postsToSort) {
            let sortedPosts = [...postsToSort];
            
            // Apply primary sort
            if (currentSort === 'popular') {
                sortedPosts.sort((a, b) => b.likes - a.likes);
            } else if (currentSort === 'unresolved') {
                // For demo, mark posts with 0 comments as unresolved
                sortedPosts = sortedPosts.filter(post => post.comments === 0);
            }
            
            // Apply order
            if (currentOrder === 'oldest') {
                sortedPosts.reverse();
            }
            
            return sortedPosts;
        }

        // Add event listeners to post elements
        function addPostEventListeners() {
            // Like buttons
            document.querySelectorAll('.like-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const postId = parseInt(this.getAttribute('data-post-id'));
                    toggleLike(postId, this);
                });
            });
            
            // Comment buttons
            document.querySelectorAll('.comment-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const postId = parseInt(this.getAttribute('data-post-id'));
                    toggleComments(postId);
                });
            });
            
            // Save buttons
            document.querySelectorAll('.save-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const postId = parseInt(this.getAttribute('data-post-id'));
                    toggleSave(postId, this);
                });
            });
            
            // Add comment buttons
            document.querySelectorAll('.add-comment').forEach(button => {
                button.addEventListener('click', function() {
                    const postId = parseInt(this.getAttribute('data-post-id'));
                    addComment(postId);
                });
            });
            
            // Convert to Campus Cart buttons
            document.querySelectorAll('.convert-to-cart').forEach(button => {
                button.addEventListener('click', function() {
                    const postId = parseInt(this.getAttribute('data-post-id'));
                    convertToCampusCart(postId);
                });
            });
            
            // Share location buttons
            document.querySelectorAll('.share-location').forEach(button => {
                button.addEventListener('click', function() {
                    const postId = parseInt(this.getAttribute('data-post-id'));
                    shareLocation(postId);
                });
            });
        }

        // Toggle like on a post
        function toggleLike(postId, button) {
            const post = posts.find(p => p.id === postId);
            if (post) {
                post.liked = !post.liked;
                post.likes += post.liked ? 1 : -1;
                
                const icon = button.querySelector('i');
                const count = button.querySelector('.like-count');
                
                if (post.liked) {
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    button.classList.add('active');
                    showToast('Post liked!', 'success');
                } else {
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                    button.classList.remove('active');
                }
                
                count.textContent = post.likes;
            }
        }

        // Toggle comments section
        function toggleComments(postId) {
            const commentsSection = document.getElementById(`comments-${postId}`);
            if (commentsSection) {
                commentsSection.style.display = commentsSection.style.display === 'none' ? 'block' : 'none';
            }
        }

        // Toggle save on a post
        function toggleSave(postId, button) {
            const post = posts.find(p => p.id === postId);
            if (post) {
                post.saved = !post.saved;
                
                const icon = button.querySelector('i');
                
                if (post.saved) {
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    button.classList.add('active');
                    showToast('Post saved to your Private Drive!', 'success');
                } else {
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                    button.classList.remove('active');
                }
            }
        }

        // Add a comment to a post
        function addComment(postId) {
            const commentInput = document.getElementById(`comment-input-${postId}`);
            const commentText = commentInput.value.trim();
            
            if (!commentText) {
                showToast('Please enter a comment', 'warning');
                return;
            }
            
            const post = posts.find(p => p.id === postId);
            if (post) {
                const newComment = {
                    user: "You",
                    text: commentText,
                    time: "Just now"
                };
                
                post.commentsList.unshift(newComment);
                post.comments += 1;
                
                // Update UI
                const commentList = document.getElementById(`comment-list-${postId}`);
                const newCommentHTML = `
                    <div class="comment">
                        <div class="d-flex justify-content-between">
                            <strong>${newComment.user}</strong>
                            <small class="text-muted">${newComment.time}</small>
                        </div>
                        <p class="mb-0">${newComment.text}</p>
                    </div>
                `;
                
                commentList.innerHTML = newCommentHTML + commentList.innerHTML;
                commentInput.value = '';
                
                // Update comment count in the button
                const commentBtn = document.querySelector(`.comment-btn[data-post-id="${postId}"]`);
                if (commentBtn) {
                    commentBtn.innerHTML = `<i class="far fa-comment me-1"></i> ${post.comments}`;
                }
                
                showToast('Comment added!', 'success');
            }
        }

        // Convert post to Campus Cart listing
        function convertToCampusCart(postId) {
            const post = posts.find(p => p.id === postId);
            if (post) {
                showToast('Post converted to Campus Cart listing!', 'success');
                // In a real app, this would make an API call to create a listing in Campus Cart
                console.log('Converting to Campus Cart:', post);
            }
        }

        // Share location (integration with Campus Locator)
        function shareLocation(postId) {
            const post = posts.find(p => p.id === postId);
            if (post) {
                showToast('Location shared via UniSphere Locator!', 'success');
                // In a real app, this would open Campus Locator with the relevant location
                console.log('Sharing location for:', post);
            }
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            
            const bgClass = {
                'success': 'bg-success',
                'warning': 'bg-warning',
                'error': 'bg-danger',
                'info': 'bg-primary'
            }[type] || 'bg-primary';
            
            const toastHTML = `
                <div id="${toastId}" class="toast align-items-center text-white ${bgClass} border-0" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHTML);
            
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement, { delay: 3000 });
            toast.show();
            
            // Remove toast from DOM after it's hidden
            toastElement.addEventListener('hidden.bs.toast', function() {
                toastElement.remove();
            });
        }

        // Update stats (mock data for demo)
        function updateStats() {
            // In a real app, these would come from the backend
            statsElements.postsToday.textContent = posts.length + 139; // Adding to sample data
            statsElements.resolvedRate.textContent = '87%';
            statsElements.activeUsers.textContent = '32';
            statsElements.urgentPosts.textContent = posts.filter(p => p.tags.includes('urgent')).length + 11;
        }
        // NEW: Load posts from Firebase
async function loadPostsFromFirebase() {
    try {
        const snapshot = await db.collection('campusBuzz_posts')
            .orderBy('timestamp', 'desc')
            .get();
        
        posts = [];
        snapshot.forEach(doc => {
            const data = doc.data();
            // Convert Firestore timestamp to readable time
            if (data.timestamp && data.timestamp.toDate) {
                data.time = formatTimeAgo(data.timestamp.toDate());
            }
            posts.push({ id: doc.id, ...data });
        });
        
        // If no posts in DB, use sample posts
        if (posts.length === 0) {
            posts = [...samplePosts];
        }
        
        renderPosts();
    } catch (error) {
        console.error("Error loading posts:", error);
        // Fallback to sample posts
        posts = [...samplePosts];
        renderPosts();
    }
}

// NEW: Helper function for time formatting
function formatTimeAgo(date) {
    const now = new Date();
    const diffInSeconds = Math.floor((now - date) / 1000);
    
    if (diffInSeconds < 60) return 'Just now';
    if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} mins ago`;
    if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} hours ago`;
    return `${Math.floor(diffInSeconds / 86400)} days ago`;
}
    </script>
</body>
</html>